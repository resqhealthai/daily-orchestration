<!DOCTYPE html>
<html>
<head>
    <title>ResQ Smart Viewer</title>
    <meta charset="utf-8">
    <style>
        body, html { width: 100%; height: 100%; background: #000; margin: 0; overflow: hidden; }
        
        #debug {
            position: fixed; top: 10px; left: 10px; z-index: 99999;
            color: #0f0; background: rgba(0,0,0,0.8); padding: 5px;
            font-family: monospace; border: 1px solid #0f0;
        }
    </style>
    <!-- Use UNPKG which worked for you -->
    <script crossorigin src="https://unpkg.com/@daily-co/daily-js"></script>
</head>
<body>
    <div id="debug">Init...</div>

    <script>
        // === CSS RULES ===
        // We inject these dynamically to force the layout
        const cssFace = `
            /* FACE MODE: Hide Screen Shares */
            .daily-video-div.daily-screen-share { display: none !important; }
            
            /* Make Camera Full Screen */
            .daily-video-div {
                position: fixed !important; top: 0; left: 0;
                width: 100vw !important; height: 100vh !important;
                z-index: 10;
            }
            .daily-video-div.local { display: none !important; }
        `;

        const cssScreen = `
            /* SCREEN MODE: Prioritize Screen Share */
            .daily-video-div.daily-screen-share { 
                display: block !important;
                position: fixed !important; top: 0; left: 0;
                width: 100vw !important; height: 100vh !important;
                z-index: 100 !important; /* On Top of Camera */
            }
            /* Hide Normal Camera (by pushing it behind or hiding) */
            .daily-video-div:not(.daily-screen-share) {
                z-index: 1; /* Behind */
            }
            .daily-video-div.local { display: none !important; }
        `;

        const d = document.getElementById('debug');
        
        setInterval(() => {
            if(window.DailyIframe) init();
        }, 500);

        let hasInit = false;

        async function init() {
            if(hasInit) return;
            hasInit = true;
            d.innerText = "SDK Loaded";

            const params = new URLSearchParams(window.location.search);
            const roomUrl = params.get('roomUrl');
            const mode = params.get('mode') || 'face';

            if(!roomUrl) { d.innerText = "No URL"; return; }

            // Select CSS based on mode
            const myCSS = (mode === 'face') ? cssFace : cssScreen;

            // Create Frame
            const callFrame = window.DailyIframe.createFrame(document.body, {
                showLeaveButton: false,
                showFullscreenButton: false,
                iframeStyle: {
                    position: 'fixed', width: '100%', height: '100%', border: '0'
                },
                cssText: myCSS // <--- Apply the filter
            });

            d.innerText = "Joining...";

            try {
                await callFrame.join({
                    url: roomUrl,
                    showLocalVideo: false,
                    startVideoOff: true,
                    startAudioOff: false,
                    userName: `Display-${mode}`,
                    
                    // KEY: Use Grid mode (activeSpeaker: false)
                    // This forces all videos to render, letting our CSS filter them.
                    activeSpeakerMode: false,
                    subscribeToTracksAutomatically: true
                });
                d.innerText = `Active (${mode})`;
            } catch(e) {
                d.innerText = `Error: ${e.message}`;
            }
        }
    </script>
</body>
</html>
